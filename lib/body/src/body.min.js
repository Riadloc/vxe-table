"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,_xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,o){return l in e?Object.defineProperty(e,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[l]=o,e}function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.optimizeOpts.delayHover}function renderBorder(e,l){return e("div",{class:"vxe-table-".concat(l,"ed-borders"),ref:"".concat(l,"Borders")},[e("span",{class:"vxe-table-border-top",ref:"".concat(l,"Top")}),e("span",{class:"vxe-table-border-right",ref:"".concat(l,"Right")}),e("span",{class:"vxe-table-border-bottom",ref:"".concat(l,"Bottom")}),e("span",{class:"vxe-table-border-left",ref:"".concat(l,"Left")})])}function renderColumn(e,l,c,o,t,i,s,a,d,u,f,p,v){var r,n,x=c._e,g=c.$listeners,y=c.tableData,m=c.height,b=c.columnKey,w=c.overflowX,h=c.scrollXLoad,_=c.scrollYLoad,T=c.highlightCurrentRow,$=c.showOverflow,C=c.align,I=c.cellClassName,S=c.spanMethod,k=c.radioConfig,L=void 0===k?{}:k,B=c.expandConfig,R=void 0===B?{}:B,P=c.treeConfig,E=void 0===P?{}:P,O=c.mouseConfig,q=void 0===O?{}:O,D=c.editConfig,H=c.editRules,U=c.validOpts,M=c.editStore,X=c.validStore,Y=f.editRender,A=f.align,N=f.showOverflow,j=f.className,z=M.actived,F=i?f.fixed!==i:f.fixed&&w,K=_xeUtils.default.isUndefined(N)||_xeUtils.default.isNull(N)?$:N,V="ellipsis"===K,W="title"===K,G=!0===K||"tooltip"===K,J=W||G||V,Q={},Z=A||C,ee=(X=Object.assign({visible:!1,row:null,column:null,content:"",rule:null},X["".concat(f.property,"_").concat(a._XID)])).visible,le=H&&("default"===U.message?m||1<y.length:"inline"===U.message),oe={"data-colid":f.id},te=Y&&D&&"dblclick"===D.trigger,re={$table:c,$seq:o,seq:t,row:a,rowIndex:d,$rowIndex:u,column:f,columnIndex:p,$columnIndex:v,fixed:i,isHidden:F,level:s,data:y},ne=d===y.length-1,ce=c.checkboxConfig||c.selectConfig||{};if(!h&&!_||J||(V=!0),(W||G||g["cell-mouseenter"])&&(Q.mouseenter=function(e){if(!isOperateMouse(c)){var l={$table:c,seq:t,row:a,rowIndex:d,$rowIndex:u,column:f,columnIndex:p,$columnIndex:v,fixed:i,isHidden:F,level:s,cell:e.currentTarget};W?_tools.DomTools.updateCellTitle(e):G&&c.triggerTooltipEvent(e,l),_tools.UtilTools.emitEvent(c,"cell-mouseenter",[l,e])}}),(G||g["cell-mouseleave"])&&(Q.mouseleave=function(e){isOperateMouse(c)||(G&&c.clostTooltip(),_tools.UtilTools.emitEvent(c,"cell-mouseleave",[{$table:c,seq:t,row:a,rowIndex:d,$rowIndex:u,column:f,columnIndex:p,$columnIndex:v,fixed:i,isHidden:F,level:s,cell:e.currentTarget},e]))}),(q.checked||q.selected)&&(Q.mousedown=function(e){c.triggerCellMousedownEvent(e,{$table:c,seq:t,row:a,rowIndex:d,$rowIndex:u,column:f,columnIndex:p,$columnIndex:v,fixed:i,isHidden:F,level:s,cell:e.currentTarget})}),(T||g["cell-click"]||q.checked||Y&&D||"row"===R.trigger||"cell"===R.trigger||"row"===L.trigger||"radio"===f.type&&"cell"===L.trigger||"row"===ce.trigger||("checkbox"===f.type||"selection"===f.type)&&"cell"===ce.trigger||"row"===E.trigger||f.treeNode&&"cell"===E.trigger)&&(Q.click=function(e){if(c.triggerCellClickEvent(e,{$table:c,row:a,rowIndex:d,$rowIndex:u,column:f,columnIndex:p,$columnIndex:v,fixed:i,isHidden:F,level:s,cell:e.currentTarget}),q.selected){var l=e.currentTarget;if(l.classList.contains("col--selected")){var o=e.layerY;if(l.getBoundingClientRect().height<o||o<0){var t=M.selected,r=t.column,n=t.row[r.property];y.forEach(function(e){_tools.UtilTools.setCellValue(e,r,n)})}}}}),(te||g["cell-dblclick"])&&(Q.dblclick=function(e){c.triggerCellDBLClickEvent(e,{$table:c,seq:t,row:a,rowIndex:d,$rowIndex:u,column:f,columnIndex:p,$columnIndex:v,fixed:i,isHidden:F,level:s,cell:e.currentTarget})}),S){var ie=S(re)||{},se=ie.rowspan,ae=void 0===se?1:se,de=ie.colspan,ue=void 0===de?1:de;if(!ae||!ue)return null;oe.rowspan=ae,oe.colspan=ue}!F&&D&&D.showStatus&&(n=c.hasRowChange(a,f.property));var fe=D&&Y&&z.row===a&&(z.column===f||"row"===D.mode);return e("td",{class:["vxe-body--column",f.id,(r={},_defineProperty(r,"col--".concat(Z),Z),_defineProperty(r,"col--edit",Y),_defineProperty(r,"col--index","index"===f.type),_defineProperty(r,"col--ellipsis",J),_defineProperty(r,"row--last",ne),_defineProperty(r,"edit--visible",Y&&"visible"===Y.type),_defineProperty(r,"fixed--hidden",F),_defineProperty(r,"col--dirty",n),_defineProperty(r,"col--actived",fe),_defineProperty(r,"col--valid-error",ee),r),_tools.UtilTools.getClass(j,re),_tools.UtilTools.getClass(I,re)],key:b?f.id:p,attrs:oe,on:Q},$&&F?[]:[e("div",{class:["vxe-cell",{"c--title":W,"c--tooltip":G,"c--ellipsis":V}],attrs:{title:W?_tools.UtilTools.getCellLabel(a,f,re):null}},f.renderCell(e,re)),le?ee&&fe?e("div",{class:"vxe-cell--valid",style:X.rule&&X.rule.width?{width:"".concat(X.rule.width,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},X.content)]):x():null])}function renderRows(u,f,p,v,x,g,e,y){var m=p.rowKey,b=p.highlightHoverRow,w=p.rowClassName,h=p.treeConfig,_=p.treeExpandeds,T=p.scrollYLoad,$=p.scrollYStore,C=p.editStore,I=p.expandeds,S=p.getColumnIndex,k=[];return e.forEach(function(t,r){var e,l={},n=r,c=n+1;T&&(c+=$.startIndex),n=p.getRowIndex(t),b&&(l.mouseenter=function(e){isOperateMouse(p)||p.triggerHoverEvent(e,{row:t,rowIndex:n})},l.mouseleave=function(e){isOperateMouse(p)||p.clearHoverRow()});var o=_tools.UtilTools.getRowid(p,t);if(k.push(u("tr",{class:["vxe-body--row",(e={},_defineProperty(e,"row--level-".concat(x),h),_defineProperty(e,"row--new",-1<C.insertList.indexOf(t)),e),w?_xeUtils.default.isFunction(w)?w({$table:p,$seq:v,seq:c,fixedType:g,rowLevel:x,row:t,rowIndex:n,$rowIndex:r}):w:""],attrs:{"data-rowid":o},key:m||h?o:r,on:l},y.map(function(e,l){var o=S(e);return renderColumn(u,f,p,v,c,g,x,t,n,r,e,o,l)}))),I.length&&-1<I.indexOf(t)){var i,s=y.find(function(e){return"expand"===e.type}),a=S(s);h&&(i={paddingLeft:"".concat(x*(h.indent||16)+30,"px")}),s&&k.push(u("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(o),on:l},[u("td",{class:"vxe-body--expanded-column",attrs:{colspan:y.length}},[u("div",{class:["vxe-body--expanded-cell",{"fixed--hidden":g}],style:i},[s.renderData(u,{$table:p,seq:c,row:t,rowIndex:n,column:s,columnIndex:a,fixed:g,level:x})])])]))}if(h&&_.length){var d=t[h.children];d&&d.length&&-1<_.indexOf(t)&&k.push.apply(k,renderRows(u,f,p,v?"".concat(v,".").concat(c):"".concat(c),x+1,g,d,y))}}),k}function syncBodyScroll(e,l,o){(l||o)&&(l&&(l.onscroll=null,l.scrollTop=e),o&&(o.onscroll=null,o.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){l&&(l.onscroll=l._onscroll),o&&(o.onscroll=o._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,l=this.$el,o=this.$refs,t=this.fixedType,r=e.elemStore,n="".concat(t||"main","-body-");r["".concat(n,"wrapper")]=l,r["".concat(n,"table")]=o.table,r["".concat(n,"colgroup")]=o.colgroup,r["".concat(n,"list")]=o.tbody,r["".concat(n,"xSpace")]=o.xSpace,r["".concat(n,"ySpace")]=o.ySpace,r["".concat(n,"emptyBlock")]=o.emptyBlock,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(o){var e=this._e,l=this.$parent,t=this.fixedColumn,r=this.fixedType,n=l.$scopedSlots,c=l.tableData,i=l.tableColumn,s=l.showOverflow,a=l.scrollXLoad,d=l.mouseConfig,u=void 0===d?{}:d,f=l.keyboardConfig,p=void 0===f?{}:f;return r&&s?i=t:a&&r&&(i=t),o("div",{class:["vxe-table--body-wrapper",r?"fixed-".concat(r,"--wrapper"):"body--wrapper"]},[r?e():o("div",{class:"vxe-body--x-space",ref:"xSpace"}),o("div",{class:"vxe-body--y-space",ref:"ySpace"}),o("table",{class:"vxe-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[o("colgroup",{ref:"colgroup"},i.map(function(e,l){return o("col",{attrs:{name:e.id},key:l})})),o("tbody",{ref:"tbody"},renderRows(o,this,l,"",0,r,c,i))]),r||!u.checked&&!p.isCut?null:o("div",{class:"vxe-table--borders"},[u.checked?renderBorder(o,"check"):null,p.isCut?renderBorder(o,"copy"):null]),r?null:o("div",{class:"vxe-table--empty-block".concat(c.length?"":" is--visible"),ref:"emptyBlock"},[o("span",{class:"vxe-table--empty-text"},n.empty?n.empty.call(this,{$table:l},o):_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var l=this.$parent,o=this.fixedType,t=l.$refs,r=l.highlightHoverRow,n=l.scrollXLoad,c=l.scrollYLoad,i=l.lastScrollTop,s=l.lastScrollLeft,a=t.tableHeader,d=t.tableBody,u=t.leftBody,f=t.rightBody,p=t.tableFooter,v=a?a.$el:null,x=p?p.$el:null,g=d.$el,y=u?u.$el:null,m=f?f.$el:null,b=g.scrollTop,w=g.scrollLeft,h=w!==s,_=b!==i;l.lastScrollTop=b,l.lastScrollLeft=w,l.lastScrollTime=Date.now(),r&&l.clearHoverRow(),y&&"left"===o?syncBodyScroll(b=y.scrollTop,g,m):m&&"right"===o?syncBodyScroll(b=m.scrollTop,g,y):(h&&(v&&(v.scrollLeft=g.scrollLeft),x&&(x.scrollLeft=g.scrollLeft)),(y||m)&&(l.checkScrolling(),_&&syncBodyScroll(b,y,m))),n&&h&&(l.triggerScrollXEvent(e),v&&w+g.clientWidth>=g.scrollWidth&&this.$nextTick(function(){g.scrollLeft!==v.scrollLeft&&(v.scrollLeft=g.scrollLeft)})),c&&_&&l.triggerScrollYEvent(e),_tools.UtilTools.emitEvent(l,"scroll",[{type:"body",fixed:o,scrollTop:b,scrollLeft:w,isX:h,isY:_,$table:l},e])}}};exports.default=_default;